<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Resume & Use Template</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fff9c4;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .upload-box, .template-selection {
      max-width: 800px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    input[type="file"] {
      display: block;
      margin: 20px auto;
    }
    textarea {
      width: 100%;
      height: 150px;
      margin-top: 20px;
      padding: 10px;
    }
    .templates {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    .template {
      width: 45%;
      background: #fff9c4;
      padding: 20px;
      margin: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .template button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      background-color: #ffd600;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }
    .template-preview {
      height: 100px;
      margin-bottom: 10px;
      background-color: #e0e0e0;
    }
  </style>
</head>
<body>

  <h2>Upload Your Resume PDF</h2>

  <div class="upload-box">
    <input type="file" id="fileInput" accept="application/pdf">
    <textarea id="extractedText" placeholder="Extracted text will appear here..." readonly></textarea>
  </div>

  <div class="template-selection">
    <h3>Select a Template to Use</h3>
    <div class="templates">
      <div class="template">
        <div class="template-preview">Template-1 Preview</div>
        <button onclick="goToTemplate(1)">Use Template 1</button>
      </div>
      <div class="template">
        <div class="template-preview">ATS-Friendly Template</div>
        <button onclick="goToTemplate(7)">Use Template 7</button>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('extractedText');

    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file && file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = function() {
          const typedarray = new Uint8Array(this.result);
          pdfjsLib.getDocument(typedarray).promise.then(pdf => {
            let text = '';
            let pagePromises = [];

            for (let i = 1; i <= pdf.numPages; i++) {
              pagePromises.push(
                pdf.getPage(i).then(page => {
                  return page.getTextContent().then(content => {
                    return content.items.map(item => item.str).join(' ');
                  });
                })
              );
            }

            Promise.all(pagePromises).then(pagesText => {
              output.value = pagesText.join('\n\n');
              localStorage.setItem('resumeText', output.value);
            });
          });
        };
        reader.readAsArrayBuffer(file);
      } else {
        alert('Please upload a PDF file.');
      }
    });

    function goToTemplate(number) {
      window.location.href = `edit-template-from-pdf.html?template=${number}`;
    }
  </script>

</body>
</html>
